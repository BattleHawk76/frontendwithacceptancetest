<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for 3/src/field/common/mixinBosInput.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../../prettify.css" />
    <link rel="stylesheet" href="../../../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../../../index.html">All files</a> / <a href="index.html">3/src/field/common</a> mixinBosInput.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/29</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/20</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/6</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/28</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151</td><td class="line-coverage quiet"><span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">export let initmixinBosInput = <span class="cstat-no" title="statement not covered" >{</span>
&nbsp;
  data() {
<span class="cstat-no" title="statement not covered" >    return {</span>
      //默认处理器，必须包含strip和wrap二属性。
      // 即通过v-model绑定的value先通过strip方法处理成计算属性copyVal,
      // 一旦用户完成输入后在发出的双向绑定input事件发出之前，用wrap将copyVal的新值先处理好
      //可以想像查询条件面板的输入字符串需要被当作like输入给后端，需要前后都加上%.
      defaultHandler: {
        strip: <span class="fstat-no" title="function not covered" >function (</span>value) {
<span class="cstat-no" title="statement not covered" >          return value;</span>
        },
        wrap: <span class="fstat-no" title="function not covered" >function (</span>value) {
<span class="cstat-no" title="statement not covered" >          return value;</span>
        }
      }
    }
  },
  props: {
    value:null,
    // 特意去掉此项，以便减少使用者的工作量，直接下使用下面的rules来代替 暂时不删是因为怕其他组件报错 TODO 删除这个属性，但依照element的实现，怕是没那么容易去掉，除非能从v-model属性中拿到绑定字符串。
    prop: {
      type: String,
      default: '',
    },
    /*综合考虑以下3点原因，抛弃form-item的required属性,我们自己处理并与常规rule放到一起进行验证。
    1.element-ui的formitem中的required值为true/false，其实是削弱了asyn-validator的required的能力（本来可以明确类型的{type:number,required},
    2.但另一方面asyn-validator的requreid的错误提示中没法插入我们字段中文别名，
    3.required应该放在其他rule前面执行，如果不满足则直接返回。这个在element-ui中如果存在多个rules，似乎智能手写到data中去？没法启用required属性？
    */
    /*  required: {
        type: Boolean,
        default: false,
      },
  */
&nbsp;
    /*验证规则，尽可能与element-ui的格式相同，如常见的:
{required: true, message: '请输入手机号', trigger: 'blur'},
{max: 11, message: '长度不超过11位', trigger: 'blur'},
{validator: validateTel, trigger: 'blur'}
  let validateTel = (rule, value, callback) =&gt; {
    let reg = /^((13|14|15|17|18)[0-9]{1}\d{8})$/;
    if (!reg.test(value)) {
      callback(new Error('手机号格式不正确'));
    } else {
      callback();
    }
  };
  在element-form表单介绍中提到："Form 组件提供了表单验证的功能，只需要通过 rules 属性传入约定的验证规则，并将 Form-Item 的 prop 属性设置为需校验的字段名即可。校验规则参见 async-validator"
  地址：https://github.com/yiminghe/async-validator
  有更多的规则可以参考，如：
&nbsp;
  {type: "string", required: true},
&nbsp;
&nbsp;
  可以看到element仅仅是对他的rule做了一个扩展，添加了trigger和message两项内容
  而从源代码得知，trigger主要有三类:'blur','change',''.
&nbsp;
*/
    handler: {
      type: Object, default: null
    },
&nbsp;
    rules: null,
&nbsp;
    width: {
      type: [Number, String],
      default: 3.3,
    },
    label: {
      type: String,
      default: ''
    },
&nbsp;
    //过滤器，显示的内容格式字符串，各种组件对格式的使用不同，另外组件可编辑时
    // 如何处理好输入显示和普通显示？似乎可以用获得焦点时显示临时输入内容（或原有内容copy过来的临时内容），失去焦点后显示过滤器处理后的内容。 TODO
&nbsp;
    inputValue: null,
&nbsp;
    helper: null,
&nbsp;
&nbsp;
  },
&nbsp;
  computed: {
&nbsp;
    copyVal: {
      get: <span class="fstat-no" title="function not covered" >function () </span>{
        var finalHandler = <span class="cstat-no" title="statement not covered" >!!this.handler ? this.handler : this.defaultHandler;</span>
<span class="cstat-no" title="statement not covered" >        return finalHandler.strip.call(this,this.value);</span>
      },
      set: <span class="fstat-no" title="function not covered" >function (</span>newVal) {
        var finalHandler = <span class="cstat-no" title="statement not covered" >!!this.handler ? this.handler : this.defaultHandler;</span>
<span class="cstat-no" title="statement not covered" >        this.$emit('input', finalHandler.wrap.call(this,newVal));</span>
      }
    },
&nbsp;
    cRules() {
      //如果是必填，必须第一个验证必填。
      var rules = <span class="cstat-no" title="statement not covered" >[];</span>
<span class="cstat-no" title="statement not covered" >      rules.push(...((this.rules || {rules: []}).rules));</span>
      //将label传进去，以便验证规则的错误提示可以引用他而不是prop名。
      var fieldalias = <span class="cstat-no" title="statement not covered" >this.label;</span>
<span class="cstat-no" title="statement not covered" >      return rules.map(<span class="fstat-no" title="function not covered" >function (</span>rule) {</span>
        var result = <span class="cstat-no" title="statement not covered" >{};</span>
<span class="cstat-no" title="statement not covered" >        Object.assign(result, rule);</span>
<span class="cstat-no" title="statement not covered" >        if (rule.checker) {</span>
<span class="cstat-no" title="statement not covered" >          result.validator = <span class="fstat-no" title="function not covered" >function (</span>rule2, value, callback, source, options) {</span>
            var result = <span class="cstat-no" title="statement not covered" >rule.checker.call(rule.context, value);//绑定this到vm.data</span>
            //如果有定制的错误提示则采用定制的,否则采用验证器提供的错误信息
<span class="cstat-no" title="statement not covered" >            callback((result !== true) ? new Error((rule.errormsg ? rule.errormsg : result).replace(/%s/, fieldalias)) : []);</span>
          }
        }
<span class="cstat-no" title="statement not covered" >        return result;</span>
      });
    }
  },
&nbsp;
  methods: {
    change(val) {
<span class="cstat-no" title="statement not covered" >      this.$emit('change', val);</span>
    },
    blur(event) {
<span class="cstat-no" title="statement not covered" >      this.$emit('blur', event);</span>
    },
    focus(event) {
<span class="cstat-no" title="statement not covered" >      this.$emit('focus', event);</span>
    },
    transformNumber(flag) {
<span class="cstat-no" title="statement not covered" >      return +flag;</span>
    },
    transformBoolean(flag, set) {
<span class="cstat-no" title="statement not covered" >      if (set === true &amp;&amp; this.$parent.$parent._readonly) <span class="cstat-no" title="statement not covered" >return true;</span></span>
      //获取 form-container的_readonly，只有使用slot，$parent才能拿到
      //this.$parent为 el-form
      //this.$parent.$parent为 form-container
<span class="cstat-no" title="statement not covered" >      if (typeof flag === 'string') {</span>
<span class="cstat-no" title="statement not covered" >        flag = (flag === 'true') ? true : false;</span>
      }
<span class="cstat-no" title="statement not covered" >      return flag;</span>
    },
&nbsp;
&nbsp;
    validate() {
      //this.$refs.formitem.clearValidate(); 验证前是否需要清除？
<span class="cstat-no" title="statement not covered" >      return this.$refs.formitem.validate.apply(this.$refs.formitem, arguments);</span>
    }
&nbsp;
  }
};
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Thu Mar 28 2019 10:40:25 GMT+0800 (China Standard Time)
</div>
</div>
<script src="../../../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../../../sorter.js"></script>
</body>
</html>
